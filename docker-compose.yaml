services:
  clawdbot:
    build: .
    user: '0:0'
    restart: on-failure:3
    ulimits:
      nofile:
        soft: 65535
        hard: 65535
    environment:
      PORT: 18789
      NODE_ENV: production
      NODE_OPTIONS: '--max-old-space-size=1536'
      HOME: /home/node
      TERM: xterm-256color
      CLAWDBOT_GATEWAY_BIND: auto
      CLAWDBOT_GATEWAY_PORT: 18789

      SERVICE_URL_CLAWDBOT_18789: null
      BASE_URL: 'https://${SERVICE_FQDN_CLAWDBOT}'
      PUBLIC_URL: 'https://${SERVICE_FQDN_CLAWDBOT}'
      # Bootstrap controls
      CLAWDBOT_AUTO_BOOTSTRAP: "1"
      CLAWDBOT_PRINT_ACCESS: "1"
      GATEWAY_TRUSTED_PROXIES: '[*]'

    volumes:
      - clawdbot-config:/home/node/.clawdbot
      - clawdbot-workspace:/home/node/clawd

    command: ["bash", "/app/scripts/bootstrap.sh"]

volumes:
  clawdbot-config:
  clawdbot-workspace: